<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ Teste de DetecÃ§Ã£o AutomÃ¡tica de Idioma - Atalho</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: linear-gradient(135deg, #f0e9df 0%, #f7f3ed 50%, #ffffff 100%);
      min-height: 100vh;
    }
    
    .container {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    h1 {
      color: #8B4513;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2rem;
    }
    
    .test-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      border-left: 4px solid #dbc9ad;
    }
    
    .test-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #dbc9ad;
      border-radius: 8px;
      font-size: 16px;
      margin: 10px 0;
      box-sizing: border-box;
    }
    
    .test-button {
      background: linear-gradient(135deg, #dbc9ad, #c8b299);
      color: #333;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      margin: 5px;
      transition: all 0.3s ease;
    }
    
    .test-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(219, 201, 173, 0.4);
    }
    
    .result {
      background: #e8f5e8;
      border: 1px solid #c3e6cb;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    
    .error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    
    .info-box {
      background: #d1ecf1;
      border: 1px solid #b8daff;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    
    .language-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    
    .language-card {
      background: white;
      border: 1px solid #dbc9ad;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .language-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .flag {
      font-size: 2rem;
      margin-bottom: 10px;
    }
    
    .stats {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
    }
    
    code {
      background: #f1f3f4;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
    }
    
    .detection-log {
      background: #2d3748;
      color: #e2e8f0;
      border-radius: 8px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      margin: 15px 0;
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸŒ Sistema de DetecÃ§Ã£o AutomÃ¡tica de Idioma</h1>
    
    <div class="info-box">
      <h3>ğŸ¯ Como funciona a detecÃ§Ã£o:</h3>
      <p><strong>Prioridade de detecÃ§Ã£o:</strong></p>
      <ol>
        <li><strong>DomÃ­nio do email</strong> (gmail.com.br â†’ pt-br)</li>
        <li><strong>Timezone/PaÃ­s</strong> (America/Sao_Paulo â†’ BR â†’ pt-br)</li>
        <li><strong>Idioma do navegador</strong> (navigator.language)</li>
        <li><strong>PadrÃ£o</strong> (pt-br)</li>
      </ol>
    </div>

    <!-- SeÃ§Ã£o de teste manual -->
    <div class="test-section">
      <h3>ğŸ§ª Teste a DetecÃ§Ã£o de Idioma</h3>
      <p>Digite um email para ver qual idioma seria detectado:</p>
      
      <input type="email" 
             id="test-email" 
             class="test-input" 
             placeholder="exemplo@gmail.com.br"
             value="">
      
      <div>
        <button class="test-button" onclick="testLanguageDetection()">
          ğŸ” Detectar Idioma
        </button>
        <button class="test-button" onclick="showBrowserInfo()">
          ğŸŒ Info do Navegador
        </button>
        <button class="test-button" onclick="clearResults()">
          ğŸ§¹ Limpar
        </button>
      </div>
      
      <div id="detection-result"></div>
    </div>

    <!-- Exemplos prÃ©-definidos -->
    <div class="test-section">
      <h3>ğŸ¯ Exemplos de DetecÃ§Ã£o</h3>
      <p>Clique para testar diferentes tipos de email:</p>
      
      <div class="language-grid">
        <div class="language-card">
          <div class="flag">ğŸ‡§ğŸ‡·</div>
          <strong>PortuguÃªs (Brasil)</strong>
          <div>
            <button class="test-button" onclick="testEmail('usuario@gmail.com.br')">gmail.com.br</button>
            <button class="test-button" onclick="testEmail('teste@uol.com.br')">uol.com.br</button>
          </div>
        </div>
        
        <div class="language-card">
          <div class="flag">ğŸ‡ªğŸ‡¸</div>
          <strong>EspaÃ±ol</strong>
          <div>
            <button class="test-button" onclick="testEmail('usuario@gmail.es')">gmail.es</button>
            <button class="test-button" onclick="testEmail('test@yahoo.es')">yahoo.es</button>
          </div>
        </div>
        
        <div class="language-card">
          <div class="flag">ğŸ‡«ğŸ‡·</div>
          <strong>FranÃ§ais</strong>
          <div>
            <button class="test-button" onclick="testEmail('utilisateur@gmail.fr')">gmail.fr</button>
            <button class="test-button" onclick="testEmail('test@hotmail.fr')">hotmail.fr</button>
          </div>
        </div>
        
        <div class="language-card">
          <div class="flag">ğŸ‡©ğŸ‡ª</div>
          <strong>Deutsch</strong>
          <div>
            <button class="test-button" onclick="testEmail('benutzer@gmail.de')">gmail.de</button>
            <button class="test-button" onclick="testEmail('test@yahoo.de')">yahoo.de</button>
          </div>
        </div>
        
        <div class="language-card">
          <div class="flag">ğŸ‡®ğŸ‡¹</div>
          <strong>Italiano</strong>
          <div>
            <button class="test-button" onclick="testEmail('utente@gmail.it')">gmail.it</button>
            <button class="test-button" onclick="testEmail('test@hotmail.it')">hotmail.it</button>
          </div>
        </div>
        
        <div class="language-card">
          <div class="flag">ğŸ‡ºğŸ‡¸</div>
          <strong>English (fallback)</strong>
          <div>
            <button class="test-button" onclick="testEmail('user@gmail.com')">gmail.com</button>
            <button class="test-button" onclick="testEmail('test@yahoo.com')">yahoo.com</button>
          </div>
        </div>
      </div>
    </div>

    <!-- EstatÃ­sticas do sistema -->
    <div class="stats">
      <h3>ğŸ“Š InformaÃ§Ãµes do Sistema</h3>
      <div id="system-stats">
        <p><strong>Seu navegador:</strong> <span id="browser-lang">Carregando...</span></p>
        <p><strong>Timezone:</strong> <span id="timezone">Carregando...</span></p>
        <p><strong>PaÃ­s estimado:</strong> <span id="estimated-country">Carregando...</span></p>
      </div>
    </div>

    <!-- Log de detecÃ§Ã£o -->
    <div class="test-section">
      <h3>ğŸ“‹ Log de DetecÃ§Ã£o</h3>
      <div id="detection-log" class="detection-log">
        Aguardando testes...<br>
      </div>
    </div>

    <!-- Teste completo de registro -->
    <div class="test-section">
      <h3>ğŸš€ Teste Completo de Registro</h3>
      <p>Este teste simula o processo completo de registro com detecÃ§Ã£o automÃ¡tica:</p>
      
      <input type="email" 
             id="full-test-email" 
             class="test-input" 
             placeholder="seu-email@exemplo.com"
             value="">
      
      <button class="test-button" onclick="simulateFullRegistration()">
        ğŸ¯ Simular Registro Completo
      </button>
      
      <div id="full-test-result"></div>
    </div>
  </div>

  <script>
    // FunÃ§Ã£o principal de detecÃ§Ã£o de idioma (cÃ³pia da implementaÃ§Ã£o)
    function detectUserLanguage(email) {
      try {
        // Detectar informaÃ§Ãµes do navegador
        const browserLanguage = navigator.language || navigator.userLanguage;
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        
        // Tentar detectar paÃ­s pelo timezone
        let country = null;
        const timezoneCountryMap = {
          'America/Sao_Paulo': 'BR',
          'America/Argentina/Buenos_Aires': 'AR',
          'Europe/Madrid': 'ES',
          'Europe/Paris': 'FR',
          'Europe/Berlin': 'DE',
          'Europe/Rome': 'IT',
          'Europe/London': 'GB',
          'America/New_York': 'US',
          'America/Los_Angeles': 'US'
        };
        
        if (timezoneCountryMap[timezone]) {
          country = timezoneCountryMap[timezone];
        }

        // EstratÃ©gias de detecÃ§Ã£o
        const emailDomain = email.split('@')[1];
        const domainLanguages = {
          'gmail.com.br': 'pt-br',
          'yahoo.com.br': 'pt-br',
          'hotmail.com.br': 'pt-br',
          'outlook.com.br': 'pt-br',
          'uol.com.br': 'pt-br',
          'terra.com.br': 'pt-br',
          'gmail.es': 'es',
          'yahoo.es': 'es',
          'hotmail.es': 'es',
          'gmail.fr': 'fr',
          'yahoo.fr': 'fr',
          'hotmail.fr': 'fr',
          'gmail.de': 'de',
          'yahoo.de': 'de',
          'hotmail.de': 'de',
          'gmail.it': 'it',
          'yahoo.it': 'it',
          'hotmail.it': 'it'
        };

        const countryLanguages = {
          'BR': 'pt-br',
          'ES': 'es',
          'FR': 'fr',
          'DE': 'de',
          'IT': 'it',
          'US': 'en',
          'GB': 'en',
          'AU': 'en',
          'CA': 'en'
        };

        const browserLangMap = {
          'pt': 'pt-br',
          'pt-BR': 'pt-br',
          'pt-PT': 'pt-br',
          'es': 'es',
          'es-ES': 'es',
          'es-MX': 'es',
          'fr': 'fr',
          'fr-FR': 'fr',
          'fr-CA': 'fr',
          'en': 'en',
          'en-US': 'en',
          'en-GB': 'en',
          'de': 'de',
          'de-DE': 'de',
          'it': 'it',
          'it-IT': 'it'
        };

        // Prioridade: domÃ­nio > paÃ­s > navegador > padrÃ£o
        let detectedLanguage = 'pt-br';
        let reason = 'padrÃ£o';

        if (domainLanguages[emailDomain]) {
          detectedLanguage = domainLanguages[emailDomain];
          reason = `domÃ­nio (${emailDomain})`;
        } else if (country && countryLanguages[country]) {
          detectedLanguage = countryLanguages[country];
          reason = `paÃ­s/timezone (${country})`;
        } else if (browserLanguage && browserLangMap[browserLanguage]) {
          detectedLanguage = browserLangMap[browserLanguage];
          reason = `navegador (${browserLanguage})`;
        }

        return {
          language: detectedLanguage,
          reason: reason,
          details: {
            email: email,
            domain: emailDomain,
            country: country,
            browser: browserLanguage,
            timezone: timezone
          }
        };

      } catch (error) {
        console.error('Erro na detecÃ§Ã£o de idioma:', error);
        return {
          language: 'pt-br',
          reason: 'erro (fallback)',
          error: error.message
        };
      }
    }

    // FunÃ§Ã£o para testar detecÃ§Ã£o
    function testLanguageDetection() {
      const email = document.getElementById('test-email').value.trim();
      
      if (!email) {
        showResult('âŒ Por favor, digite um email para testar.', 'error');
        return;
      }

      if (!email.includes('@')) {
        showResult('âŒ Por favor, digite um email vÃ¡lido.', 'error');
        return;
      }

      const result = detectUserLanguage(email);
      logDetection(`Teste: ${email}`, result);
      
      const languageNames = {
        'pt-br': 'ğŸ‡§ğŸ‡· PortuguÃªs (Brasil)',
        'es': 'ğŸ‡ªğŸ‡¸ EspaÃ±ol',
        'fr': 'ğŸ‡«ğŸ‡· FranÃ§ais',
        'en': 'ğŸ‡ºğŸ‡¸ English',
        'de': 'ğŸ‡©ğŸ‡ª Deutsch',
        'it': 'ğŸ‡®ï¿½ï¿½ Italiano'
      };

      showResult(`
        <strong>âœ… Resultado da DetecÃ§Ã£o:</strong><br><br>
        <strong>Email:</strong> ${result.details.email}<br>
        <strong>Idioma detectado:</strong> ${languageNames[result.language] || result.language}<br>
        <strong>Motivo:</strong> ${result.reason}<br><br>
        
        <strong>ğŸ“‹ Detalhes tÃ©cnicos:</strong><br>
        â€¢ DomÃ­nio: ${result.details.domain}<br>
        â€¢ PaÃ­s estimado: ${result.details.country || 'nÃ£o detectado'}<br>
        â€¢ Idioma do navegador: ${result.details.browser}<br>
        â€¢ Timezone: ${result.details.timezone}
      `);
    }

    // FunÃ§Ã£o para testar email especÃ­fico
    function testEmail(email) {
      document.getElementById('test-email').value = email;
      testLanguageDetection();
    }

    // FunÃ§Ã£o para mostrar info do navegador
    function showBrowserInfo() {
      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      const language = navigator.language || navigator.userLanguage;
      const languages = navigator.languages || [language];
      
      showResult(`
        <strong>ğŸŒ InformaÃ§Ãµes do seu navegador:</strong><br><br>
        <strong>Idioma principal:</strong> ${language}<br>
        <strong>Idiomas aceitos:</strong> ${languages.join(', ')}<br>
        <strong>Timezone:</strong> ${timezone}<br>
        <strong>User Agent:</strong> ${navigator.userAgent.substring(0, 100)}...
      `);
    }

    // FunÃ§Ã£o para mostrar resultado
    function showResult(content, type = 'result') {
      const resultDiv = document.getElementById('detection-result');
      resultDiv.innerHTML = `<div class="${type}">${content}</div>`;
    }

    // FunÃ§Ã£o para limpar resultados
    function clearResults() {
      document.getElementById('detection-result').innerHTML = '';
      document.getElementById('test-email').value = '';
    }

    // FunÃ§Ã£o para log de detecÃ§Ã£o
    function logDetection(action, result) {
      const log = document.getElementById('detection-log');
      const timestamp = new Date().toLocaleTimeString();
      
      log.innerHTML += `[${timestamp}] ${action}<br>`;
      log.innerHTML += `  â†’ Idioma: ${result.language} (${result.reason})<br>`;
      if (result.error) {
        log.innerHTML += `  â†’ Erro: ${result.error}<br>`;
      }
      log.innerHTML += `<br>`;
      log.scrollTop = log.scrollHeight;
    }

    // FunÃ§Ã£o para simular registro completo
    function simulateFullRegistration() {
      const email = document.getElementById('full-test-email').value.trim();
      
      if (!email || !email.includes('@')) {
        document.getElementById('full-test-result').innerHTML = 
          '<div class="error">âŒ Por favor, digite um email vÃ¡lido.</div>';
        return;
      }

      // Simular o processo completo
      const result = detectUserLanguage(email);
      logDetection(`Registro simulado: ${email}`, result);
      
      const languageNames = {
        'pt-br': 'PortuguÃªs (Brasil)',
        'es': 'EspaÃ±ol',
        'fr': 'FranÃ§ais',
        'en': 'English',
        'de': 'Deutsch',
        'it': 'Italiano'
      };

      // Simular configuraÃ§Ã£o do Firebase
      const firebaseLanguageMap = {
        'pt-br': 'pt',
        'es': 'es',
        'fr': 'fr',
        'en': 'en',
        'de': 'de',
        'it': 'it'
      };

      const firebaseLang = firebaseLanguageMap[result.language] || 'pt';

      document.getElementById('full-test-result').innerHTML = `
        <div class="result">
          <strong>ğŸ‰ SimulaÃ§Ã£o de Registro Completa!</strong><br><br>
          
          <strong>ğŸ“§ Email:</strong> ${email}<br>
          <strong>ğŸŒ Idioma detectado:</strong> ${languageNames[result.language]}<br>
          <strong>ğŸ”§ Firebase configurado para:</strong> ${firebaseLang}<br>
          <strong>ğŸ“‹ Motivo da detecÃ§Ã£o:</strong> ${result.reason}<br><br>
          
          <strong>âœ… Processo que seria executado:</strong><br>
          1. âœ… DetecÃ§Ã£o automÃ¡tica de idioma concluÃ­da<br>
          2. âœ… Firebase Auth configurado para "${firebaseLang}"<br>
          3. âœ… UsuÃ¡rio seria criado com createUserWithEmailAndPassword()<br>
          4. âœ… Email de verificaÃ§Ã£o seria enviado em ${languageNames[result.language]}<br>
          5. âœ… URL do email: https://atalho.me/emailHandler.html?lang=${result.language}<br>
          6. âœ… PreferÃªncia salva no Firestore<br><br>
          
          <strong>ğŸ¯ Resultado:</strong> O usuÃ¡rio receberia todos os emails futuros em ${languageNames[result.language]}!
        </div>
      `;
    }

    // Inicializar informaÃ§Ãµes do sistema
    function initSystemInfo() {
      document.getElementById('browser-lang').textContent = 
        navigator.language || navigator.userLanguage;
      
      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      document.getElementById('timezone').textContent = timezone;
      
      // Estimar paÃ­s pelo timezone
      const timezoneCountryMap = {
        'America/Sao_Paulo': 'Brasil ğŸ‡§ğŸ‡·',
        'America/Argentina/Buenos_Aires': 'Argentina ğŸ‡¦ğŸ‡·',
        'Europe/Madrid': 'Espanha ğŸ‡ªğŸ‡¸',
        'Europe/Paris': 'FranÃ§a ğŸ‡«ğŸ‡·',
        'Europe/Berlin': 'Alemanha ğŸ‡©ğŸ‡ª',
        'Europe/Rome': 'ItÃ¡lia ğŸ‡®ğŸ‡¹',
        'Europe/London': 'Reino Unido ğŸ‡¬ğŸ‡§',
        'America/New_York': 'Estados Unidos ğŸ‡ºğŸ‡¸',
        'America/Los_Angeles': 'Estados Unidos ğŸ‡ºğŸ‡¸'
      };
      
      const estimatedCountry = timezoneCountryMap[timezone] || 'NÃ£o identificado';
      document.getElementById('estimated-country').textContent = estimatedCountry;
    }

    // Inicializar pÃ¡gina
    document.addEventListener('DOMContentLoaded', function() {
      initSystemInfo();
      console.log('ğŸŒ PÃ¡gina de teste de detecÃ§Ã£o automÃ¡tica de idioma carregada');
    });
  </script>
</body>
</html> 